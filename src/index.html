<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Personal Info Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;600&family=Oxanium:wght@400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              ui: ["IBM Plex Sans", "sans-serif"],
              display: ["Oxanium", "sans-serif"],
            },
            colors: {
              panel: "#0a0a0a",
              panelBorder: "#1f1f1f",
              accent: "#20c997",
              dim: "#9aa0a6",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-black text-white font-ui min-h-screen">
    <div class="w-full max-w-none mx-auto px-8 py-4 h-[360px] aspect-[16/3]">
      <header class="mb-4 md:mb-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="bg-panel border border-panelBorder rounded-2xl p-5 flex items-center justify-between">
            <div>
              <p class="text-dim text-sm uppercase tracking-widest">Now</p>
              <p id="date" class="text-lg md:text-xl"></p>
            </div>
            <div class="text-right">
              <p id="time" class="font-display text-4xl md:text-6xl tracking-wider"></p>
              <p id="timezone" class="text-dim text-sm"></p>
            </div>
          </div>
          <div class="bg-panel border border-panelBorder rounded-2xl p-5 flex items-center justify-between">
            <div>
              <p class="text-dim text-sm uppercase tracking-widest">Weather</p>
              <div class="flex items-center gap-3 mt-2">
                <span id="weather-icon" class="text-4xl">--</span>
                <div>
                  <p id="weather-temp" class="font-display text-4xl">--Â°C</p>
                  <p id="weather-desc" class="text-dim text-sm">--</p>
                </div>
              </div>
            </div>
            <div class="text-right text-sm">
              <p class="text-dim">Wind</p>
              <p id="weather-wind" class="font-display text-xl">-- km/h</p>
              <p id="location" class="text-dim text-xs mt-1">Tokyo</p>
            </div>
          </div>
          <div class="bg-panel border border-panelBorder rounded-2xl p-5">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-dim text-sm uppercase tracking-widest">Earthquake</p>
                <p class="text-dim text-xs">Latest 3</p>
              </div>
              <span class="text-dim text-sm">P2P</span>
            </div>
            <div id="quake-list" class="mt-3 space-y-2 text-sm"></div>
          </div>
        </div>
      </header>

      <main class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
        <section class="lg:col-span-2 bg-panel border border-panelBorder rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <h2 class="font-display text-2xl">Weather Outlook</h2>
            <span class="text-dim text-sm">Open-Meteo</span>
          </div>
          <div class="mt-4 bg-black/60 rounded-xl p-4">
            <p class="text-dim text-sm">Next 12 Hours (3h)</p>
            <div id="forecast" class="mt-3 grid grid-cols-2 md:grid-cols-4 gap-3 text-sm"></div>
          </div>
        </section>

        <section class="bg-panel border border-panelBorder rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <h2 class="font-display text-2xl">Status</h2>
          </div>
          <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
            <div class="bg-black/60 rounded-xl p-3">
              <p class="text-dim">Weather Update</p>
              <p id="weather-updated" class="font-display text-lg">--:--</p>
            </div>
            <div class="bg-black/60 rounded-xl p-3">
              <p class="text-dim">News Update</p>
              <p id="news-updated" class="font-display text-lg">--:--</p>
            </div>
            <div class="bg-black/60 rounded-xl p-3">
              <p class="text-dim">Quake Update</p>
              <p id="quake-updated" class="font-display text-lg">--:--</p>
            </div>
            <div class="bg-black/60 rounded-xl p-3">
              <p class="text-dim">Timezone</p>
              <p class="text-sm" id="timezone-compact">--</p>
            </div>
          </div>
        </section>

        <section class="lg:col-span-3 bg-panel border border-panelBorder rounded-2xl p-5">
          <div class="flex items-center justify-between">
            <h2 class="font-display text-2xl">News</h2>
            <span class="text-dim text-sm">NHK Feed</span>
          </div>
          <div id="news-list" class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </section>
      </main>
    </div>

    <script>
      const LOCATION = {
        // å¤©æ°—ã®å–å¾—åº§æ¨™ï¼ˆå¤‰æ›´å¯èƒ½ï¼‰
        name: "Tokyo",
        latitude: 35.6895,
        longitude: 139.6917,
      };

      const WEATHER_ENDPOINT = (lat, lon) =>
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m&hourly=temperature_2m,precipitation_probability,weather_code&timezone=Asia%2FTokyo`;

      const QUAKE_ENDPOINT = "https://api.p2pquake.net/v2/history?codes=551&limit=3";

      const NHK_RSS =
        "https://www.nhk.or.jp/rss/news/cat0.xml";
      const RSS2JSON =
        (rssUrl) => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;

      const weatherIcons = {
        0: { icon: "â˜€ï¸", label: "Clear" },
        1: { icon: "ğŸŒ¤ï¸", label: "Mostly Clear" },
        2: { icon: "â›…", label: "Partly Cloudy" },
        3: { icon: "â˜ï¸", label: "Overcast" },
        45: { icon: "ğŸŒ«ï¸", label: "Fog" },
        48: { icon: "ğŸŒ«ï¸", label: "Rime Fog" },
        51: { icon: "ğŸŒ¦ï¸", label: "Drizzle" },
        53: { icon: "ğŸŒ¦ï¸", label: "Drizzle" },
        55: { icon: "ğŸŒ§ï¸", label: "Heavy Drizzle" },
        61: { icon: "ğŸŒ§ï¸", label: "Rain" },
        63: { icon: "ğŸŒ§ï¸", label: "Rain" },
        65: { icon: "ğŸŒ§ï¸", label: "Heavy Rain" },
        71: { icon: "â„ï¸", label: "Snow" },
        73: { icon: "â„ï¸", label: "Snow" },
        75: { icon: "â„ï¸", label: "Heavy Snow" },
        80: { icon: "ğŸŒ¦ï¸", label: "Showers" },
        81: { icon: "ğŸŒ¦ï¸", label: "Showers" },
        82: { icon: "ğŸŒ¦ï¸", label: "Heavy Showers" },
        95: { icon: "â›ˆï¸", label: "Thunderstorm" },
        96: { icon: "â›ˆï¸", label: "Thunderstorm" },
        99: { icon: "â›ˆï¸", label: "Thunderstorm" },
      };

      const fallbackNews = [
        {
          title: "ãƒ‡ãƒ¢: é€Ÿå ±ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®è¦‹å‡ºã—",
          description: "RSSå–å¾—ã«å¤±æ•—ã—ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¡¨ç¤ºã§ã™ã€‚",
          pubDate: new Date().toISOString(),
          link: "https://www.nhk.or.jp/",
        },
        {
          title: "ãƒ‡ãƒ¢: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å‘ã‘ã®è¦‹å‡ºã—",
          description: "ã‚«ãƒ¼ãƒ‰å½¢å¼ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹è¡¨ç¤ºã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚",
          pubDate: new Date().toISOString(),
          link: "https://www.nhk.or.jp/",
        },
        {
          title: "ãƒ‡ãƒ¢: å¤©æ°—ã‚„åœ°éœ‡ã¨é€£å‹•",
          description: "å¿…è¦ã«å¿œã˜ã¦åˆ¥ã®RSSã«å·®ã—æ›¿ãˆå¯èƒ½ã§ã™ã€‚",
          pubDate: new Date().toISOString(),
          link: "https://www.nhk.or.jp/",
        },
      ];

      const timeEl = document.getElementById("time");
      const dateEl = document.getElementById("date");
      const timezoneEl = document.getElementById("timezone");
      const timezoneCompactEl = document.getElementById("timezone-compact");
      const locationEl = document.getElementById("location");
      const weatherUpdatedEl = document.getElementById("weather-updated");
      const newsUpdatedEl = document.getElementById("news-updated");
      const quakeUpdatedEl = document.getElementById("quake-updated");

      const weatherIconEl = document.getElementById("weather-icon");
      const weatherTempEl = document.getElementById("weather-temp");
      const weatherDescEl = document.getElementById("weather-desc");
      const weatherWindEl = document.getElementById("weather-wind");
      const forecastEl = document.getElementById("forecast");

      const quakeListEl = document.getElementById("quake-list");
      const newsListEl = document.getElementById("news-list");

      function formatDateTime(date) {
        return new Intl.DateTimeFormat("ja-JP", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          weekday: "short",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        }).format(date);
      }

      function updateClock() {
        const now = new Date();
        const time = new Intl.DateTimeFormat("ja-JP", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        }).format(now);
        const weekday = new Intl.DateTimeFormat("ja-JP", {
          weekday: "short",
        }).format(now);
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const date = `${year}å¹´${month}æœˆ${day}æ—¥ (${weekday})`;

        timeEl.textContent = time;
        dateEl.textContent = date;
        const zone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        timezoneEl.textContent = zone;
        timezoneCompactEl.textContent = zone;
      }

      function toLocalTimeLabel(isoString) {
        const date = new Date(isoString);
        return new Intl.DateTimeFormat("ja-JP", {
          hour: "2-digit",
          minute: "2-digit",
        }).format(date);
      }

      function mapWeather(code) {
        return weatherIcons[code] || { icon: "â”", label: "Unknown" };
      }

      async function fetchWeather() {
        try {
          // Open-Meteo ã‹ã‚‰å¤©æ°—ã‚’å–å¾—
          const response = await fetch(WEATHER_ENDPOINT(LOCATION.latitude, LOCATION.longitude));
          if (!response.ok) throw new Error("Weather fetch failed");
          const data = await response.json();

          const current = data.current;
          const mapped = mapWeather(current.weather_code);
          weatherIconEl.textContent = mapped.icon;
          weatherTempEl.textContent = `${Math.round(current.temperature_2m)}Â°C`;
          weatherDescEl.textContent = mapped.label;
          weatherWindEl.textContent = `${Math.round(current.wind_speed_10m)} km/h`;

          forecastEl.innerHTML = "";
          const times = data.hourly.time;
          const temps = data.hourly.temperature_2m;
          const codes = data.hourly.weather_code;
          const pops = data.hourly.precipitation_probability;

          for (let i = 0; i < times.length && forecastEl.children.length < 4; i += 3) {
            const item = document.createElement("div");
            const w = mapWeather(codes[i]);
            const pop = pops ? `${pops[i]}%` : "--";
            item.className = "flex items-center justify-between bg-black/40 rounded-lg px-3 py-2";
            item.innerHTML = `
              <div>
                <p class="text-dim text-xs">${toLocalTimeLabel(times[i])}</p>
                <p class="text-lg">${w.icon}</p>
              </div>
              <div class="text-right">
                <p class="font-display text-lg">${Math.round(temps[i])}Â°</p>
                <p class="text-dim text-xs">POP ${pop}</p>
              </div>
            `;
            forecastEl.appendChild(item);
          }

          weatherUpdatedEl.textContent = new Intl.DateTimeFormat("ja-JP", {
            hour: "2-digit",
            minute: "2-digit",
          }).format(new Date());
        } catch (error) {
          weatherDescEl.textContent = "Weather unavailable";
        }
      }

      function quakeCard(quake) {
        const time = quake.time ? formatDateTime(new Date(quake.time)) : "--";
        const hypo = quake.earthquake?.hypocenter?.name || "--";
        const magnitude = quake.earthquake?.hypocenter?.magnitude ?? "--";
        const maxScale = quake.earthquake?.maxScale ?? "--";

        return `
          <div class="bg-black/60 rounded-xl p-3">
            <p class="text-dim text-xs">${time}</p>
            <p class="text-lg">${hypo}</p>
            <div class="mt-1 flex items-center justify-between text-sm">
              <span>Max: ${maxScale}</span>
              <span>M ${magnitude}</span>
            </div>
          </div>
        `;
      }

      async function fetchQuakes() {
        try {
          // P2Påœ°éœ‡æƒ…å ±APIã‹ã‚‰å–å¾—
          const response = await fetch(QUAKE_ENDPOINT);
          if (!response.ok) throw new Error("Quake fetch failed");
          const data = await response.json();
          quakeListEl.innerHTML = data.map(quakeCard).join("");
          quakeUpdatedEl.textContent = new Intl.DateTimeFormat("ja-JP", {
            hour: "2-digit",
            minute: "2-digit",
          }).format(new Date());
        } catch (error) {
          quakeListEl.innerHTML = '<p class="text-dim">Earthquake feed unavailable.</p>';
        }
      }

      function newsCard(item) {
        const date = item.pubDate ? formatDateTime(new Date(item.pubDate)) : "--";
        const link = item.link || "#";
        return `
          <article class="bg-black/60 rounded-xl p-4 flex flex-col gap-3">
            <div class="flex items-start justify-between gap-3">
              <h3 class="font-display text-lg leading-tight">${item.title}</h3>
              <div class="w-12 h-12 bg-black/70 border border-panelBorder rounded-lg flex items-center justify-center text-xs text-dim">
                QR
              </div>
            </div>
            <p class="text-dim text-sm max-h-16 overflow-hidden">${item.description || ""}</p>
            <div class="text-xs text-dim flex items-center justify-between">
              <span>${date}</span>
              <a class="text-accent" href="${link}" target="_blank" rel="noopener">Open</a>
            </div>
          </article>
        `;
      }

      async function fetchNews() {
        try {
          // RSSã‚’rss2jsonçµŒç”±ã§å–å¾—ï¼ˆCORSå›é¿ï¼‰
          const response = await fetch(RSS2JSON(NHK_RSS));
          if (!response.ok) throw new Error("News fetch failed");
          const data = await response.json();
          const items = (data.items || []).slice(0, 6).map((item) => ({
            title: item.title,
            description: item.description?.replace(/<[^>]+>/g, ""),
            pubDate: item.pubDate,
            link: item.link,
          }));
          newsListEl.innerHTML = items.length ? items.map(newsCard).join("") : fallbackNews.map(newsCard).join("");
          newsUpdatedEl.textContent = new Intl.DateTimeFormat("ja-JP", {
            hour: "2-digit",
            minute: "2-digit",
          }).format(new Date());
        } catch (error) {
          newsListEl.innerHTML = fallbackNews.map(newsCard).join("");
        }
      }

      function init() {
        locationEl.textContent = LOCATION.name;
        updateClock();
        setInterval(updateClock, 1000);

        fetchWeather();
        fetchNews();
        fetchQuakes();

        // 1æ™‚é–“ã”ã¨ã«è‡ªå‹•æ›´æ–°
        setInterval(fetchWeather, 60 * 60 * 1000);
        setInterval(fetchNews, 30 * 60 * 1000);
        setInterval(fetchQuakes, 10 * 60 * 1000);
      }

      init();
    </script>
  </body>
</html>
